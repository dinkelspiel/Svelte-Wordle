<script>
	var words = [
		"faith",
		"story",
		"judge",
		"piano",
		"angry",
		"upper",
		"swear",
		"skill",
		"issue",
		"moral",
		"ahead",
		"minor",
		"mayor",
		"proof",
		"swing",
		"draft",
		"relax",
		"fresh",
		"worth",
		"union",
		"laugh",
		"first",
		"frame",
		"bring",
		"these",
		"heart",
		"trace",
		"chest",
		"super",
		"lover",
		"eager",
		"often",
		"stuff",
		"drive",
		"smoke",
		"leave",
		"smart",
		"large",
		"strip",
		"until",
		"after",
		"rough",
		"empty",
		"habit",
		"worry",
		"agent",
		"media",
		"movie",
		"fence",
		"whose",
		"match",
		"stage",
		"cable",
		"grade",
		"aware",
		"since",
		"river",
		"paint",
		"earth",
		"three",
		"chain",
		"stand",
		"under",
		"terms",
		"water",
		"plate",
		"shoot",
		"clear",
		"bench",
		"route",
		"humor",
		"fifth",
		"chart",
		"grass",
		"admit",
		"uncle",
		"coast",
		"angle",
		"power",
		"basis",
		"quick",
		"party",
		"forth",
		"seven",
		"solve",
		"lucky",
		"prime",
		"award",
		"weigh",
		"horse",
		"cloud",
		"speed",
		"theme",
		"there",
		"teach",
		"elite",
		"trail",
		"truly",
		"truck",
		"trade",
		"scale",
		"wheel",
		"dirty",
		"blame",
		"chair",
		"state",
		"newly",
		"daily",
		"dance",
		"legal",
		"rifle",
		"month",
		"young",
		"great",
		"shell",
		"anger",
		"alter",
		"taste",
		"shall",
		"tight",
		"count",
		"stock",
		"might",
		"child",
		"clock",
		"stick",
		"early",
		"quiet",
		"brand",
		"awful",
		"fault",
		"blade",
		"today",
		"false",
		"north",
		"treat",
		"coach",
		"giant",
		"essay",
		"mouse",
		"house",
		"speak",
		"broad",
		"elect",
		"stone",
		"steel",
		"field",
		"shirt",
		"plane",
		"voter",
		"store",
		"react",
		"meter",
		"other",
		"money",
		"marry",
		"storm",
		"green",
		"those",
		"build",
		"given",
		"track",
		"yours",
		"plant",
		"whole",
		"trust",
		"cause",
		"drama",
		"order",
		"sharp",
		"delay",
		"grave",
		"human",
		"value",
		"music",
		"total",
		"alone",
		"block",
		"knock",
		"shore",
		"irish",
		"armed",
		"model",
		"salad",
		"virus",
		"trial",
		"pause",
		"aside",
		"layer",
		"nurse",
		"lemon",
		"crime",
		"guess",
		"tough",
		"entry",
		"buyer",
		"eight",
		"noise",
		"sweet",
		"chase",
		"color",
		"enjoy",
		"pilot",
		"motor",
		"below",
		"cross",
		"still",
		"thank",
		"local",
		"heavy",
		"write",
		"level",
		"patch",
		"shake",
		"price",
		"front",
		"sight",
		"raise",
		"prove",
		"least",
		"rapid",
		"solar",
		"mount",
		"again",
		"carry",
		"ghost",
		"reach",
		"fight",
		"shift",
		"metal",
		"major",
		"honey",
		"ought",
		"steal",
		"sugar",
		"sorry",
		"sound",
		"ratio",
		"youth",
		"float",
		"mouth",
		"short",
		"light",
		"sport",
		"while",
		"grain",
		"dream",
		"adopt",
		"loose",
		"drink",
		"thick",
		"basic",
		"urban",
		"force",
		"woman",
		"cycle",
		"usual",
		"staff",
		"yield",
		"troop",
		"watch",
		"cheek",
		"crack",
		"south",
		"touch",
		"place",
		"novel",
		"fiber",
		"solid",
		"asset",
		"final",
		"throw",
		"slave",
		"score",
		"print",
		"thing",
		"lower",
		"blind",
		"video",
		"sauce",
		"occur",
		"stare",
		"dozen",
		"black",
		"pitch",
		"equal",
		"seize",
		"label",
		"their",
		"exist",
		"break",
		"inner",
		"small",
		"start",
		"every",
		"ready",
		"panel",
		"hotel",
		"birth",
		"juice",
		"favor",
		"night",
		"prior",
		"sleep",
		"maker",
		"enemy",
		"above",
		"being",
		"dress",
		"style",
		"tower",
		"album",
		"iraqi",
		"rural",
		"limit",
		"funny",
		"split",
		"proud",
		"cheap",
		"naked",
		"crazy",
		"sheet",
		"wound",
		"scope",
		"white",
		"slice",
		"imply",
		"begin",
		"pound",
		"glove",
		"shout",
		"right",
		"trick",
		"visit",
		"where",
		"chief",
		"trend",
		"check",
		"slide",
		"along",
		"would",
		"think",
		"voice",
		"round",
		"radio",
		"grand",
		"scene",
		"shelf",
		"sweep",
		"shape",
		"exact",
		"about",
		"catch",
		"bread",
		"allow",
		"labor",
		"smile",
		"topic",
		"tired",
		"fully",
		"climb",
		"cream",
		"smell",
		"title",
		"learn",
		"never",
		"brain",
		"crowd",
		"vital",
		"class",
		"doubt",
		"serve",
		"glass",
		"bible",
		"bunch",
		"guard",
		"honor",
		"claim",
		"crash",
		"couch",
		"tooth",
		"guide",
		"abuse",
		"which",
		"pride",
		"happy",
		"adult",
		"depth",
		"train",
		"stake",
		"study",
		"table",
		"quote",
		"owner",
		"truth",
		"quite",
		"close",
		"photo",
		"third",
		"avoid",
		"group",
		"argue",
		"extra",
		"apply",
		"sense",
		"spend",
		"nerve",
		"phase",
		"board",
		"piece",
		"apart",
		"fewer",
		"cabin",
		"waste",
		"ocean",
		"court",
		"shrug",
		"agree",
		"ideal",
		"among",
		"grant",
		"alive",
		"refer",
		"arise",
		"enter",
		"beach",
		"later",
		"range",
		"phone",
		"fifty",
		"joint",
		"actor",
		"floor",
		"wrong",
		"latin",
		"stair",
		"guest",
		"twice",
		"porch",
		"asian",
		"adapt",
		"error",
		"flesh",
		"onion",
		"peace",
		"reply",
		"shine",
		"share",
		"brown",
		"maybe",
		"focus",
		"blood",
		"hello",
		"apple",
		"craft",
		"sales",
		"point",
		"fruit",
		"badly",
		"brief",
		"image",
		"cover",
		"tribe",
		"brush",
		"flame",
		"could",
		"event",
		"found",
		"world",
		"brick",
		"works",
		"space",
		"offer",
		"index",
		"death",
		"lunch",
		"civil",
		"press",
		"paper",
		"knife",
		"shade",
		"shock",
		"clean"
	]

	import word_list from "./en-regex"

	let current = "";

	let letters = [0, 1, 2, 3, 4]

	let startDate = "2022-01-01";
	let date1 = new Date();
	let date2 = new Date(startDate);
	let timeInMilisec = date1.getTime() - date2.getTime();
	let daysBetweenDates = Math.ceil(timeInMilisec / (1000 * 60 * 60 * 24));

	let word = words[daysBetweenDates]
	let current_guesses = []
	let current_guess = 0;

	let stop = false;
	let wrong = false;

	let save_data = JSON.parse(localStorage.getItem('stats')) == null ? {
		"1": "0",
		"2": "0",
		"3": "0",
		"4": "0",
		"5": "0",
		"last_played": "",
		"last_played_words": [],
		"last_played_guesses": ""
	} : JSON.parse(localStorage.getItem('stats'));

	let max_progess = (parseInt(save_data["1"]) + parseInt(save_data["2"]) + parseInt(save_data["3"]) + parseInt(save_data["4"]) + parseInt(save_data["5"])).toString()

	if(save_data["last_played"] == new Date().toDateString()) {
		current_guesses = save_data["last_played_words"];
		current_guess = save_data["last_played_guesses"];
		stop = true;
	}

	let counter = 0;
	const interval = setInterval(() => {!wrong ? counter = 0 : counter > 60 ? wrong = false : counter ++}, 1);

	// console.log(save_data)

	document.onkeypress = function (event) {
		if(stop)
			return;

		let char = (typeof event !== 'undefined') ? event.keyCode : event.which
		if(current.length < 5 && char != 32 && char != 13 && char != 8)
			current += String.fromCharCode(char)
		current.replace(" ", "");
		current = current;
	}

	document.onkeydown = function() {
		var key = event.keyCode || event.charCode;
		// console.log(key)
		if(stop)
			return;

		if( key == 8 ){
			current = current.slice(0, -1);
		} else if(key == 13) {
			if(current.length == 5 && word_list.includes(current)) {
				current_guesses[current_guess] = current;
				current_guess ++;
				if(current == word) {
					stop = true;
					save_data["last_played"] = new Date().toDateString();
					save_data["last_played_words"] = current_guesses;
					save_data["last_played_guesses"] = current_guess.toString();
					save_data[current_guess.toString()] = (parseInt(save_data[current_guess.toString()]) + 1).toString();
					localStorage.setItem('stats', JSON.stringify(save_data));
				}
				current = "";
				current = current.slice(0, -1);
			} else if(!word_list.includes(current)) {
				wrong = true;
			}
		}
	};

</script>

<main>
	{#each letters as row}
		<div class="wordle">
			{#each letters as i}
				<div id="square_big">
					{#if current_guess == row}
						{#if i < current.length}
							<div id="square" style={wrong ? "background-color: red;" : ""}>
								{current.split("")[i].toUpperCase()}
							</div>
						{/if}
					{:else if row < current_guess}
						<div id="square" style={word[i] == current_guesses[row][i] ? "background-color: green;" : word.includes(current_guesses[row][i]) ? "background-color: yellow;" : ""}>
							{current_guesses[row][i].toUpperCase()}
						</div>
					{/if}
				</div>
			{/each}
		</div>
	{/each}
	<div id="stats">
		<span>Completed in 1 try <progress id="stats-1" value={save_data[1].toString()} max={max_progess} /></span>
		<span>Completed in 2 try <progress id="stats-2" value={save_data[2].toString()} max={max_progess} /></span>
		<span>Completed in 3 try <progress id="stats-3" value={save_data[3].toString()} max={max_progess} /></span>
		<span>Completed in 4 try <progress id="stats-4" value={save_data[4].toString()} max={max_progess} /></span>
		<span>Completed in 5 try <progress id="stats-5" value={save_data[5].toString()} max={max_progess} /></span>
	</div>
	<button on:click={() => {
		localStorage.removeItem('stats')
	}}>
		Clear savedata
	</button>
</main>

<style>
	main {
		padding: 1em;
		display: grid;
		place-items: center;
	}

	.wordle {
		display: flex;
		gap: 5px;
		margin-bottom: 5px;
	}

	#square_big {
		display:grid;
		height: 60px;
		width: 60px;
		background-color: gray;
		text-align: center;
		align-content: center;
		font-size: 40px;
		padding: 0px;
	}

	#square {
		display:grid;
		height: 60px;
		width: 60px;
		background-color: gray;
		text-align: center;
		align-content: center;
		font-size: 40px;
		padding: 0px;
	}

	#stats {
		display: flex;
		flex-direction: column;
		margin-top: 25px;
		margin-bottom: 25px;;
	}
</style>